<section class='route map'>
  {{welcome-modal}}
  {{click-catcher}}
  <!-- floating components -->

  <div class="top-right-buttons {{if showingMenu 'active'}}">
    <button class="toggler menu-toggler" onclick={{action toggleMenu}}>
      <span class="hamburger {{if showingMenu 'active'}}"></span>
    </button>
  </div>

  {{notifications-popup}}
  <!--/ floating components -->

  <div class="panel-layer left-panel-layer {{leftPanelClass}} {{if showingLeftPanel 'active'}}">

      {{#if showingFilters}}
        {{filter-panel
          update=(action updateFilter)
          activeFilters=activeFilters
          toggleFilters=(action toggleFilters)
        }}
      {{else}}
        <div class="overflow-scroll">
          {{outlet}}
        </div>
      {{/if}}

    <div class="search-wrapper {{if (not (and showingLeftPanel showingMenu)) 'active'}}">
      <div class="filter-actions">
        <button
          onclick={{action toggleFilters}}
          class="filter-toggler {{if showingFilters 'active'}} {{if filtering 'filtering'}}"
          disabled={{showingGoto}}>
          <img src="/assets/images/filter.svg">
        </button>
        <button
          onclick={{action clearFilters}}
          class="clear-filters"
          disabled={{or showingGoto (not filtering)}}>
          X
        </button>
      </div>

      {{search-bar
        addDiscreteFilter=(action addDiscreteFilter)
        viewDevelopment=(action viewDevelopment)
        searchQuery=searchQuery
        placeholder=searchPlaceholder
        showFiltersActive=(and activeFilters (not showingFilters))
        numberOfActiveFilters=activeFilters.length
        toggleFilters=(action toggleFilters)
        model=map.stored
        disabled=(and showingLeftPanel showingMenu)
      }}
    </div>
    <div class="legend-wrapper">
      {{map-legend showing=showingFilters}}
      <div class="map-button-pair map-zoom-buttons">
        <button class="selector" onclick={{action setZoomCommand 'IN'}}>
          +
        </button>
        <button class="selector" onclick={{action setZoomCommand 'OUT'}}>
          -
        </button>
      </div>
      <div class="map-button-pair map-basemap-buttons">
        <button class="selector" disabled={{eq baseMap 'light'}} onclick={{action setBaseMap 'light'}}>
          Map
        </button>
        <button class="selector" disabled={{eq baseMap 'satellite'}} onclick={{action setBaseMap 'satellite'}}>
          Satellite
        </button>
      </div>
      <div class="info-links">
        {{link-to 'Glossary' 'glossary'}}
        {{link-to 'About' 'about'}}
      </div>
    </div>
  </div>

  <div class="map-layer">

    {{#unless (or map.stored map.filteredData)}}
      <div class="map-loading-overlay">
        <div class="loading-text">
          <h1>calbuilds</h1>

          <div class="loader">
            <span class="spinning-box"></span>
            Mapping Developments
          </div>
        </div>
      </div>
    {{/unless}}
    {{mapbox-map
      activeFilters=activeFilters
      viewDevelopment=(action viewDevelopment)
    }}
  </div>

  <div class="panel-layer right-panel-layer {{if showingMenu 'active'}}">
    {{user-panel
      panel=panel
      hideFilters=(action hideFilters)
      toggleMenu=(action toggleMenu)
      showLoginPanel=showLoginPanel
      showSignupPanel=showSignupPanel
    }}
    {{#if currentUser.user}}
      {{share-buttons
        filterParams=filterParams
        hidden=(and showingLeftPanel showingMenu)
      }}
    {{/if}}
    <footer>
      <img class="agencylogo"  src="/assets/images/ambag.jpg" style="display:block;">
        <div class="agency-details" style="display:block;">
          <span><b>Association of Monterey Bay Area Governments</b></span>
          <span>24580 Silver Cloud Court, Monterey , CA 93940</span>
          <a href="tel:8318833750">831-883-3750</a>
          <a href="mailto:ambagbuilds@ambag.org">caluilds@ambag.org</a> 
      </div>

      <img class="agencylogo"  src="/assets/images/slocog.jpeg" style="display:none;">
      <div class="agency-details" style="display:none;">
          <span><b>San Luis Obispo Council of Governments</b></span>
          <span>1114 Marsh St, San Luis Obispo, CA 93401</span>
          <a href="tel:8057814219">805-781-4219</a>
          <a href="mailto:calbuilds@ambag.org">calbuilds@slocog.org</a>  
      </div>

      <script type="text/javascript">
        let agencylogos = document.querySelectorAll('.agencylogo')
        let agency_divs = document.querySelectorAll('.agency-details')
        function intervalFunc() {
          agencylogos.forEach((d) => {
            if (d.style.display == "none") {
              d.style.display = "block";
            } else {
              d.style.display = "none";
            }
          });
          agency_divs.forEach((d) => {
            if (d.style.display == "none") {
              d.style.display = "block";
            } else {
              d.style.display = "none";
            }
          });
        }
      setInterval(intervalFunc, 1500);
      </script>
     
    </footer>
  </div>

</section>
